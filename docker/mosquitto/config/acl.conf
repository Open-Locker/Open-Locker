# This file defines the access control list for the Mosquitto MQTT broker.

# The Laravel Backend gets full access to all topics within the 'locker' namespace.
# It needs to publish commands to all lockers and subscribe to status updates from all of them.
user laravel_backend
topic readwrite locker/#

# --- Rules for registered clients ---
# A registered locker client can only access its own, dedicated topics.
# We use the '%u' pattern, which Mosquitto automatically replaces with the client's username.
# A locker's username corresponds to its unique ID (e.g., its UUID).
# This allows for a scalable configuration without needing to edit this file for every new locker.
pattern read locker/%u/command
pattern write locker/%u/status
pattern write locker/%u/state

# --- Secure rules for the provisioning client ---
# This user is for new, unregistered devices. It has very limited permissions.
user provisioning_client
# It can publish a registration request.
topic write locker/register/+
# It can ONLY subscribe to the reply topic that contains its OWN unique client ID ('%c').
# This prevents it from eavesdropping on the credentials of other devices being registered.
topic read locker/provisioning/reply/%c 